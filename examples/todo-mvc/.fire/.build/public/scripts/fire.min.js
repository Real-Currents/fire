"use strict";function _getUUID(a){var b;if("undefined"!=typeof a.toQueryValue)b=a.toQueryValue();else{if("string"!=typeof a){var c=new FireError("Parameter `"+a+"` is not a valid model instance or UUID.");throw c.status=400,c}b=a}return b}function transformQueryMap(a,b){var c={};return Object.keys(a||{}).forEach(function(b){var d=a[b];c[b]=d&&"undefined"!=typeof d.toQueryValue?d.toQueryValue():d}),b&&(c.$options=b),c}function FireError(a){this.name="FireError",this.message=a||"",this.number=-1}function unwrap(a,b){var c=b;return a.then(function(a){angular.copy(a,c)}),c}var app=angular.module("default",["ngRoute"]);app.directive("todoEscape",[function(){var a=27;return function(b,c,d){c.bind("keydown",function(c){c.keyCode===a&&b.$apply(d.todoEscape)})}}]),app.directive("todoFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.todoFocus,function(b){b&&a(function(){c[0].focus()},0,!1)})}}]),app.filter("completedFilter",["$routeParams",function(a){return function(b){return b.filter(function(b){return"completed"==a.status&&b.completed||"active"==a.status&&!b.completed||!a.status})}}]),app.controller("TodoController",["$scope","list","$routeParams",function(a,b,c){a.status=c.status||"",a.list=b,a.completeAllItems=function(){var c=!0;return a.numberOfUncompletedItems()||(c=!1),b.updateItems({completed:!c},{completed:c})},a.createItem=function(c){return c=c.trim(),c.length?b.createItem({name:c}).then(function(){a.name=""}):void 0},a.deleteItem=function(a){return b.removeItem(a)},a.toggleItem=function(a){return a.save()},a.removeCompletedItems=function(){return b.removeItems({completed:!0})},a.editItem=function(b){a.editingItem=b},a.saveItem=function(c){return a.editingItem=null,c.name=c.name.trim(),c.name.length?c.save():b.removeItem(c)},a.cancelEditingItem=function(b){return a.editingItem=null,b.cancel()},a.numberOfCompletedItems=function(){return b.items.filter(function(a){return a.completed}).length},a.numberOfUncompletedItems=function(){return b.items.length-a.numberOfCompletedItems()}}]),FireError.prototype=new Error,app.factory("_djb2Hash",function(){return function(a){for(var b=5381,c=0,d=0,e=a.length;e>d;d++)c=a.charCodeAt(d),b=33*b+c;return Math.abs(b)%(Math.pow(2,52)-1)}}),app.service("_CacheService",["$injector","$timeout",function(a,b){function c(){window.localStorage&&(console.log("Persist!"),window.localStorage.setItem(i,JSON.stringify({objects:j,keys:k,indices:l})))}function d(a){k.splice(k.indexOf(a),1),k.push(a)}function e(a){var b=a.indexOf(".");if(-1!=b){var c=a.substring(0,b),d=a.substring(b+1);return[c,d]}return[]}function f(a){var b=e(a);if(console.log("index "+b.join(" ")),b.length){var c=b[0],d=b[1];if("undefined"==typeof l[c])return l[c]=[d],!0;if(-1==l[c].indexOf(d))return l[c].push(d),!0}return!1}function g(a){console.log("unindex "+a);var b=e(a);if(b.length){var c=b[0],d=b[1];if(console.log(c+" "+d),"undefined"!=typeof l[c]){if(console.log("We have an index!"),"*"==d)return l[c].forEach(function(a){var b=c+"."+a;delete j[b],console.log("Remove object "+a);var d=k.indexOf(b);-1!=d&&(console.log("Remove key "+b),k.splice(d,1))}),delete l[c],!0;var f=l[c].indexOf(d);-1!=f&&l[c].splice(f,1)}else console.log("no index..."),console.log(l)}return!1}var h=25,i="_CacheService",j={},k=[],l={};if(this.numberOfCaches=function(){return k.length},window.localStorage){var m=window.localStorage.getItem(i);if(m)try{var n=JSON.parse(m);n&&n.objects&&n.keys&&n.indices&&(console.log("Parse data:"),console.log(n),j=n.objects,k=n.keys,l=n.indices)}catch(o){console.log("Error is:"),console.log(o),window.localStorage.setItem(i,null)}}this.remove=function(a){g(a)||("undefined"!=typeof j[a]?(console.log("delete object"),delete j[a],k.splice(k.indexOf(a),1)):console.log("doesnt exist..."))},this.removeAll=function(){j={},k=[],l={},c()},this.get=function(b,c){var e=j[b];if("undefined"!=typeof j[b]&&("undefined"==typeof c||-1==c||(new Date).getTime()-e.time<c)){if(d(b),e.value&&e.value._map&&e.value._map._type){var f=a.get("FireModelInstance"+e.value._map._type);e.value=new f(e.value._map,e.value._path)}return e.value}return null},this.put=function(a,b,d){if("undefined"!=typeof d&&(-1==d||d>0)){if(console.log("put cache "+a),k.length>h){var e=k.splice(0,k.length-h);e.forEach(function(a){g(a),j[a]=null})}f(a)&&(console.log("add key"),k.push(a)),j[a]={value:b,time:(new Date).getTime()},c()}},this.persist=function(){c()}}]),app.factory("FireModel",["$http","$q","$injector","_CacheService","$timeout","_djb2Hash",function(a,b,c,d,e,f){return function(g,h,i){this.name=g,this.autoFetchedAssociationNames=h,this.endpoint=i;var j=this;this.parse=function(a){return this.parseResult(a,null)},this.purge=function(){if(d.numberOfCaches()>0){console.log("Removing all cache for "+this.name);var a=[],b=function(e){if(-1==a.indexOf(e)){a.push(e);var f=c.get(e+"Model");console.log("    Remove association: "+e),d.remove(f.name+".*",!1),f.autoFetchedAssociationNames.forEach(function(a){b(a)})}};b(this.name),d.persist()}},this["new"]=function(){var a=c.get("FireModelInstance"+this.name);return new a(null,this.endpoint)},this.parseResult=function(a,b){function d(a){var d;return new(d=c.get(a._type?"FireModelInstance"+a._type:"FireModelInstance"+j.name))(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(d):d(a)},this._prepare=function(a){var b=function(a){var b={};return Object.keys(a||{}).forEach(function(c){b[c]=JSON.stringify(a[c])}),b};return Array.isArray(a)?a.map(b):b(a)},this._action=function(c,d,f,g){console.log("_action "+c+" on "+j.name);var h=b.defer();return e(function(){a({method:c,url:d,data:g,params:f,headers:{"x-json-params":!0,"Content-Type":"application/json;charset=utf-8"}}).success(function(a){"get"!=c&&j.purge(),h.resolve(j.parseResult(a,d))}).error(function(a,b){var c=new FireError(a);c.number=b,h.reject(c)})},1e3),h.promise},this._delete=function(a,b){return this._action("delete",a,null,this._prepare(b))},this._post=function(a,b){return this._action("post",a,null,this._prepare(b))},this._get=function(a,c){var e=this.name+"."+f(a+(Object.keys(c||{}).length>0?JSON.stringify(c):""));console.log("_get `"+e+"`"),console.log(c);var g=d.get(e,c.$options&&c.$options.cache);return!g||c.$options&&"undefined"!=typeof c.$options.returnCache&&!c.$options.returnCache?this._action("get",a,this._prepare(c)).then(function(a){return console.log("Storing cache to "+e),d.put(e,a,c.$options&&c.$options.cache),a}):(console.log("returning cached data..."),console.log(g),c.$options&&c.$options.autoReload&&(console.log("auto reload"),c.$options.returnCache=!1,delete c.$options.autoReload,this._get(a,c).then(function(a){Array.isArray(g)?g.forEach(function(b,c){c<a.length&&b.refresh(a[c])}):g.refresh(a)})),b.when(g))},this._put=function(a,b,c){return this._action("put",a,this._prepare(c),this._prepare(b))},this.update=function(a,b){return"object"==typeof a?this._put(this.endpoint,transformQueryMap(b),transformQueryMap(a)):this._put(this.endpoint+"/"+a,transformQueryMap(b))},this.remove=function(a,b){var c=null;return"undefined"!=typeof a.toQueryValue?c=a.toQueryValue():"string"==typeof a&&(c=a),c?this._action("delete",this.endpoint+"/"+c):this._action("delete",this.endpoint,this._prepare(transformQueryMap(a,b)))},this.updateOrCreate=function(a,b){return this.update(a,b).then(function(c){if(c.length)return c[0];var d={};return Object.keys(a||{}).forEach(function(b){d[b]=a[b]}),Object.keys(b||{}).forEach(function(a){d[a]=b[a]}),j.create(d)})},this.findOrCreate=function(a,b){return this.findOne(a).then(function(c){if(c)return c;var d={};return Object.keys(a||{}).forEach(function(b){d[b]=a[b]}),Object.keys(b||{}).forEach(function(a){d[a]=b[a]}),j.create(d)})},this._create=function(a,b){return Array.isArray(b)?this._post(a,b.map(function(a){return transformQueryMap(a)})):this._post(a,transformQueryMap(b))},this.create=function(a){return this._create(this.endpoint,a)},this._find=function(a,b,c){var d=transformQueryMap(b,c);return this._get(a,d)},this.find=function(a,b){return this._find(this.endpoint,a,b)},this.findOne=function(a,b){var c=a||{};if(c.id){var d=c.id;return delete c.id,this._get(this.endpoint+"/"+d,transformQueryMap(c,b)).then(function(a){return a&&(a._endpoint=j.endpoint+"/"+d),a})}var e=b||{};return e.limit=1,this.find(c,e).then(function(a){return a&&a.length?a[0]:null})},this.getOne=function(a){var c=b.defer();return this.findOne(a).then(function(a){if(a)c.resolve(a);else{var b=new FireError("Not Found");b.number=404,c.reject(b)}}),c.promise}}}]),app.factory("TodoItemModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("TodoItem",["TodoList"],"/api/todo-items");return h}]),app.factory("FireModelInstanceTodoItem",["TodoItemModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTodoItem only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.list&&null!==c.list)if(Array.isArray(c.list))c.list=c.list.map(function(a){var b=d.get("FireModelInstanceTodoList");return a._map?new b(a._map,e+"/lists"):new b(a,e+"/lists")});else{var h=d.get("FireModelInstanceTodoList");c.list=c.list._map?new h(c.list._map,e+"/lists"):new h(c.list,e+"/lists")}Object.defineProperty(this,"list",{get:function(){return"undefined"!=typeof g._changes.list?g._changes.list:g._map.list},set:function(a){g._changes.list=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),Object.defineProperty(this,"completed",{get:function(){return"undefined"!=typeof g._changes.completed?g._changes.completed:g._map.completed},set:function(a){g._changes.completed=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getList=function(b,c){return d.get("TodoListModel")._find(a.endpoint+"/"+this.id+"/list",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TodoListModel").endpoint+"/"+a.id),g.list=a,a):null})},this.createList=function(b){return d.get("TodoListModel")._create(a.endpoint+"/"+this.id+"/list",b).then(function(a){return g.list=a,a})},this.removeList=function(){return d.get("TodoListModel")._action("delete",a.endpoint+"/"+this.id+"/list").then(function(a){return g.list=null,a})}}}]),app.factory("TodoListModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("TodoList",["TodoItem"],"/api/todo-lists");return h.getCurrentList=function(){var a=(d.get("TodoItemModel"),d.get("_StorageService")),b=d.get("TodoListModel");return function(){return a.get("list")?b.findOne({id:a.get("list")},{cache:1e4,autoReload:!0}):b.create({}).then(function(b){return a.set("list",b.id),b})}.bind(this)()},h}]),app.factory("FireModelInstanceTodoList",["TodoListModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTodoList only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.items&&null!==c.items)if(Array.isArray(c.items))c.items=c.items.map(function(a){var b=d.get("FireModelInstanceTodoItem");return a._map?new b(a._map,e+"/items"):new b(a,e+"/items")});else{var h=d.get("FireModelInstanceTodoItem");c.items=c.items._map?new h(c.items._map,e+"/items"):new h(c.items,e+"/items")}Object.defineProperty(this,"items",{get:function(){return"undefined"!=typeof g._changes.items?g._changes.items:g._map.items},set:function(a){g._changes.items=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getCurrentList=function(){var a=(d.get("TodoItemModel"),d.get("_StorageService")),b=d.get("TodoListModel");return function(){return a.get("list")?b.findOne({id:a.get("list")},{cache:1e4,autoReload:!0}):b.create({}).then(function(b){return a.set("list",b.id),b})}.bind(this)()},this.getItems=function(b,c){return d.get("TodoItemModel")._find(a.endpoint+"/"+this.id+"/items",b,c).then(function(a){return g.items=a,a})},this.createItem=function(b){return d.get("TodoItemModel")._create(a.endpoint+"/"+this.id+"/items",b).then(function(a){return g.items||(g.items=[]),g.items.push(a),a})},this.removeItem=function(b){var c=_getUUID(b);return d.get("TodoItemModel")._action("delete",a.endpoint+"/"+this.id+"/items/"+c).then(function(a){for(var b=0,d=g.items.length;d>b;b++){var e=g.items[b];if(e.id===c){g.items.splice(b,1);break}}return a})},this.removeItems=function(b){return d.get("TodoItemModel")._action("delete",a.endpoint+"/"+this.id+"/items",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return g.items=g.items.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateItems=function(b,c){return d.get("TodoItemModel")._put(a.endpoint+"/"+this.id+"/items",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],e=0,f=g.items.length;f>e;e++){var h=g.items[e];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("Test",[],"/api/tests");return h}]),app.factory("FireModelInstanceTest",["TestModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTest only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),"undefined"!=typeof c.sessions&&null!==c.sessions)if(Array.isArray(c.sessions))c.sessions=c.sessions.map(function(a){var b=d.get("FireModelInstanceTestSession");return a._map?new b(a._map,e+"/sessions"):new b(a,e+"/sessions")});else{var h=d.get("FireModelInstanceTestSession");c.sessions=c.sessions._map?new h(c.sessions._map,e+"/sessions"):new h(c.sessions,e+"/sessions")}if(Object.defineProperty(this,"sessions",{get:function(){return"undefined"!=typeof g._changes.sessions?g._changes.sessions:g._map.sessions},set:function(a){g._changes.sessions=a}}),"undefined"!=typeof c.variants&&null!==c.variants)if(Array.isArray(c.variants))c.variants=c.variants.map(function(a){var b=d.get("FireModelInstanceTestVariant");return a._map?new b(a._map,e+"/variants"):new b(a,e+"/variants")});else{var h=d.get("FireModelInstanceTestVariant");c.variants=c.variants._map?new h(c.variants._map,e+"/variants"):new h(c.variants,e+"/variants")}Object.defineProperty(this,"variants",{get:function(){return"undefined"!=typeof g._changes.variants?g._changes.variants:g._map.variants},set:function(a){g._changes.variants=a}}),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getSessions=function(b,c){return d.get("TestSessionModel")._find(a.endpoint+"/"+this.id+"/sessions",b,c).then(function(a){return g.sessions=a,a})},this.createSession=function(b){return d.get("TestSessionModel")._create(a.endpoint+"/"+this.id+"/sessions",b).then(function(a){return g.sessions||(g.sessions=[]),g.sessions.push(a),a})},this.removeSession=function(b){var c=_getUUID(b);return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions/"+c).then(function(a){for(var b=0,d=g.sessions.length;d>b;b++){var e=g.sessions[b];if(e.id===c){g.sessions.splice(b,1);break}}return a})},this.removeSessions=function(b){return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return g.sessions=g.sessions.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateSessions=function(b,c){return d.get("TestSessionModel")._put(a.endpoint+"/"+this.id+"/sessions",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],e=0,f=g.sessions.length;f>e;e++){var h=g.sessions[e];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})},this.getVariants=function(b,c){return d.get("TestVariantModel")._find(a.endpoint+"/"+this.id+"/variants",b,c).then(function(a){return g.variants=a,a})},this.createVariant=function(b){return d.get("TestVariantModel")._create(a.endpoint+"/"+this.id+"/variants",b).then(function(a){return g.variants||(g.variants=[]),g.variants.push(a),a})},this.removeVariant=function(b){var c=_getUUID(b);return d.get("TestVariantModel")._action("delete",a.endpoint+"/"+this.id+"/variants/"+c).then(function(a){for(var b=0,d=g.variants.length;d>b;b++){var e=g.variants[b];if(e.id===c){g.variants.splice(b,1);break}}return a})},this.removeVariants=function(b){return d.get("TestVariantModel")._action("delete",a.endpoint+"/"+this.id+"/variants",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return g.variants=g.variants.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateVariants=function(b,c){return d.get("TestVariantModel")._put(a.endpoint+"/"+this.id+"/variants",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],e=0,f=g.variants.length;f>e;e++){var h=g.variants[e];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestParticipantModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("TestParticipant",[],"/api/test-participants");return h}]),app.factory("FireModelInstanceTestParticipant",["TestParticipantModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestParticipant only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.sessions&&null!==c.sessions)if(Array.isArray(c.sessions))c.sessions=c.sessions.map(function(a){var b=d.get("FireModelInstanceTestSession");return a._map?new b(a._map,e+"/sessions"):new b(a,e+"/sessions")});else{var h=d.get("FireModelInstanceTestSession");c.sessions=c.sessions._map?new h(c.sessions._map,e+"/sessions"):new h(c.sessions,e+"/sessions")}Object.defineProperty(this,"sessions",{get:function(){return"undefined"!=typeof g._changes.sessions?g._changes.sessions:g._map.sessions},set:function(a){g._changes.sessions=a}}),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getSessions=function(b,c){return d.get("TestSessionModel")._find(a.endpoint+"/"+this.id+"/sessions",b,c).then(function(a){return g.sessions=a,a})},this.createSession=function(b){return d.get("TestSessionModel")._create(a.endpoint+"/"+this.id+"/sessions",b).then(function(a){return g.sessions||(g.sessions=[]),g.sessions.push(a),a})},this.removeSession=function(b){var c=_getUUID(b);return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions/"+c).then(function(a){for(var b=0,d=g.sessions.length;d>b;b++){var e=g.sessions[b];if(e.id===c){g.sessions.splice(b,1);break}}return a})},this.removeSessions=function(b){return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return g.sessions=g.sessions.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateSessions=function(b,c){return d.get("TestSessionModel")._put(a.endpoint+"/"+this.id+"/sessions",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],e=0,f=g.sessions.length;f>e;e++){var h=g.sessions[e];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestSessionModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("TestSession",[],"/api/test-sessions");return h}]),app.factory("FireModelInstanceTestSession",["TestSessionModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestSession only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.test&&null!==c.test)if(Array.isArray(c.test))c.test=c.test.map(function(a){var b=d.get("FireModelInstanceTest");return a._map?new b(a._map,e+"/tests"):new b(a,e+"/tests")});else{var h=d.get("FireModelInstanceTest");c.test=c.test._map?new h(c.test._map,e+"/tests"):new h(c.test,e+"/tests")}if(Object.defineProperty(this,"test",{get:function(){return"undefined"!=typeof g._changes.test?g._changes.test:g._map.test},set:function(a){g._changes.test=a}}),"undefined"!=typeof c.participant&&null!==c.participant)if(Array.isArray(c.participant))c.participant=c.participant.map(function(a){var b=d.get("FireModelInstanceTestParticipant");return a._map?new b(a._map,e+"/participants"):new b(a,e+"/participants")});else{var h=d.get("FireModelInstanceTestParticipant");c.participant=c.participant._map?new h(c.participant._map,e+"/participants"):new h(c.participant,e+"/participants")}Object.defineProperty(this,"participant",{get:function(){return"undefined"!=typeof g._changes.participant?g._changes.participant:g._map.participant},set:function(a){g._changes.participant=a}}),Object.defineProperty(this,"variant",{get:function(){return"undefined"!=typeof g._changes.variant?g._changes.variant:g._map.variant},set:function(a){g._changes.variant=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getTest=function(b,c){return d.get("TestModel")._find(a.endpoint+"/"+this.id+"/test",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestModel").endpoint+"/"+a.id),g.test=a,a):null})},this.createTest=function(b){return d.get("TestModel")._create(a.endpoint+"/"+this.id+"/test",b).then(function(a){return g.test=a,a})},this.removeTest=function(){return d.get("TestModel")._action("delete",a.endpoint+"/"+this.id+"/test").then(function(a){return g.test=null,a})},this.getParticipant=function(b,c){return d.get("TestParticipantModel")._find(a.endpoint+"/"+this.id+"/participant",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestParticipantModel").endpoint+"/"+a.id),g.participant=a,a):null})},this.createParticipant=function(b){return d.get("TestParticipantModel")._create(a.endpoint+"/"+this.id+"/participant",b).then(function(a){return g.participant=a,a})},this.removeParticipant=function(){return d.get("TestParticipantModel")._action("delete",a.endpoint+"/"+this.id+"/participant").then(function(a){return g.participant=null,a})}}}]),app.factory("TestVariantModel",["$http","$q","FireModel","$injector","$route","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new c("TestVariant",[],"/api/test-variants");return h}]),app.factory("FireModelInstanceTestVariant",["TestVariantModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestVariant only accepts two arguments now.");this._map=c||null,this._changes={},this.toJSON=function(){return{_map:this._map,_path:e}},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),Object.defineProperty(this,"numberOfParticipants",{get:function(){return"undefined"!=typeof g._changes.numberOfParticipants?g._changes.numberOfParticipants:g._map.numberOfParticipants},set:function(a){g._changes.numberOfParticipants=a}}),"undefined"!=typeof c.test&&null!==c.test)if(Array.isArray(c.test))c.test=c.test.map(function(a){var b=d.get("FireModelInstanceTest");return a._map?new b(a._map,e+"/tests"):new b(a,e+"/tests")});else{var h=d.get("FireModelInstanceTest");c.test=c.test._map?new h(c.test._map,e+"/tests"):new h(c.test,e+"/tests")}Object.defineProperty(this,"test",{get:function(){return"undefined"!=typeof g._changes.test?g._changes.test:g._map.test},set:function(a){g._changes.test=a}}),this.cancel=function(){this._changes={}},this.reload=function(){},this.refresh=function(a){return this._map=a._map,this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){if(null===this._map)return a.create(this._changes).then(function(a){return g.refresh(a)});var c=Object.keys(this._changes).length;if(c){var d=transformQueryMap(this._changes);return a._put(this._endpoint,d).then(function(a){return console.log("Instance is:"),console.log(a),g._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(g._map[b]=a._map[b])}),g})}return b.when(this)},this.getTest=function(b,c){return d.get("TestModel")._find(a.endpoint+"/"+this.id+"/test",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestModel").endpoint+"/"+a.id),g.test=a,a):null})},this.createTest=function(b){return d.get("TestModel")._create(a.endpoint+"/"+this.id+"/test",b).then(function(a){return g.test=a,a})},this.removeTest=function(){return d.get("TestModel")._action("delete",a.endpoint+"/"+this.id+"/test").then(function(a){return g.test=null,a})}}}]),app.service("FireModels",[function(){throw new Error("FireModels service is deprecated.")}]),app.service("fire",["FireModels","$http","$q",function(a,b,c){function d(a,b){var c=b;return a.then(function(a){angular.copy(a,c)}),c}this.unwrap=d,this.models=a,this.isServer=function(){return!1},this.isClient=function(){return!0}}]),app.config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode({enabled:!0,requireBase:!1}),a.when("/",{templateUrl:"/templates/todo.html",controller:"TodoController",resolve:{list:["TodoListModel",function(a){return a.getCurrentList()}]}}),a.when("/:status",{templateUrl:"/templates/todo.html",controller:"TodoController",resolve:{list:["TodoListModel",function(a){return a.getCurrentList()}]}})}]),app.service("ChannelService",["WebSocketService","$rootScope",function(a,b){function c(a,b){return b+":"+a}var d={};this.registerChannel=function(a){d[c(a.id,a.type)]=a,this.sendMessageOnChannel({event:"_subscribe"},a)},this.getChannel=function(a,b){return d[c(a,b)]},this.getUnknownMessage=function(a,b){console.log("Unknown message.")},this.sendMessageOnChannel=function(b,c){return a.send({channel:{type:c.type,id:c.id},message:b})};var e=this;a.parsePacket=function(a){var c=e.getChannel(a.channel.id,a.channel.type);c?c.delegate?b.$apply(function(){c.delegate(a.message)}):console.log("Warning: no delegate set on channel."):b.$apply(function(){e.getUnknownMessage(a.message,a.channel)})}}]),app.service("WebSocketService",["$location","$timeout",function(a,b){
function c(){g++,i=new WebSocket("ws://"+a.host()+(a.port()?":"+a.port():"")),i.onopen=k,i.onerror=l,i.onclose=m,i.onmessage=n}var d=[],e=1e3,f=1.5,g=0,h=6e4,i=null,j=this,k=function(){if(d&&d.length>0){var a=d;d=null,a.forEach(function(a){j.send(a)})}},l=function(a){console.log("error"),console.log(a)},m=function(a){b(c,Math.max(h,e*Math.pow(f,g)))},n=function(a){var b=JSON.parse(a.data);j.parsePacket&&j.parsePacket(b)};this.send=function(a){null!==d?d.push(a):(console.log(i),i.send(JSON.stringify(a)))},this.parsePacket=null,c()}]),app.service("_StorageService",[function(){var a={};this.get=function(b){return"undefined"!=typeof a[b]?a[b]:window.localStorage.getItem(b)},this.set=function(b,c){try{window.localStorage.setItem(b,c)}catch(d){a[b]=c}},this.unset=function(b){"undefined"!=typeof a[b]?delete a[b]:window.localStorage.removeItem(b)}}]),app.provider("TestsService",[function(){var a=null;this.delegate=function(b){a=b},this.$get=function(){return{participate:function(b,c){if(null===a)throw new Error("Please set the TestsService.delegate");if("function"!=typeof a)throw new Error("TestsService#delegate must be a function.");a(b,c)}}}}]);
//# sourceMappingURL=fire.min.js.map