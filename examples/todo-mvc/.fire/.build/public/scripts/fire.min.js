"use strict";function _getUUID(a){var b;if("undefined"!=typeof a.toQueryValue)b=a.toQueryValue();else{if("string"!=typeof a){var c=new FireError("Parameter `"+a+"` is not a valid model instance or UUID.");throw c.status=400,c}b=a}return b}function transformQueryMap(a,b){var c={};return Object.keys(a||{}).forEach(function(b){var d=a[b];c[b]=d&&"undefined"!=typeof d.toQueryValue?d.toQueryValue():d}),b&&(c.$options=b),c}function FireError(a){this.name="FireError",this.message=a||"",this.number=-1}function unwrap(a,b){var c=b;return a.then(function(a){angular.copy(a,c)}),c}var app=angular.module("default",["ngRoute"]);app.directive("todoEscape",[function(){var a=27;return function(b,c,d){c.bind("keydown",function(c){c.keyCode===a&&b.$apply(d.todoEscape)})}}]),app.directive("todoFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.todoFocus,function(b){b&&a(function(){c[0].focus()},0,!1)})}}]),app.filter("completedFilter",["$routeParams",function(a){return function(b){return b.filter(function(b){return"completed"==a.status&&b.completed||"active"==a.status&&!b.completed||!a.status})}}]),app.controller("TodoController",["$scope","list","$routeParams","TodoListModel",function(a,b,c,d){a.status=c.status||"",a.list=b,console.log("Going to create:"),d.create([{},{},{}]).then(function(a){console.log("Lists:"),console.log(a)}),a.completeAllItems=function(){var c=!0;return a.numberOfUncompletedItems()||(c=!1),b.updateItems({completed:!c},{completed:c})},a.createItem=function(c){return c=c.trim(),c.length?b.createItem({name:c}).then(function(){a.name=""}):void 0},a.deleteItem=function(a){return b.removeItem(a)},a.toggleItem=function(a){return a.save()},a.removeCompletedItems=function(){return b.removeItems({completed:!0})},a.editItem=function(b){a.editingItem=b},a.saveItem=function(c){return a.editingItem=null,c.name=c.name.trim(),c.name.length?c.save():b.removeItem(c)},a.cancelEditingItem=function(b){return a.editingItem=null,b.cancel()},a.numberOfCompletedItems=function(){return b.items.filter(function(a){return a.completed}).length},a.numberOfUncompletedItems=function(){return b.items.length-a.numberOfCompletedItems()}}]),FireError.prototype=new Error,app.factory("FireModel",["$http","$q",function(a,b){return function(){this._prepare=function(a){var b=function(a){var b={};return Object.keys(a||{}).forEach(function(c){b[c]=JSON.stringify(a[c])}),b};return Array.isArray(a)?a.map(b):b(a)},this._action=function(c,d,e,f){var g=b.defer();console.log(c+" "+d),console.log(f);var h=this;return a({method:c,url:d,data:f,params:e,headers:{"x-json-params":!0}}).success(function(a){g.resolve(h.parseResult(a,d))}).error(function(a,b){var c=new FireError(a);c.number=b,g.reject(c)}),g.promise},this._post=function(a,b){return this._action("post",a,null,this._prepare(b))},this._get=function(a,b){return this._action("get",a,this._prepare(b))},this._put=function(a,b,c){return this._action("put",a,this._prepare(c),this._prepare(b))},this.update=function(a,b){return"object"==typeof a?this._put(this.endpoint,transformQueryMap(b),transformQueryMap(a)):this._put(this.endpoint+"/"+a,transformQueryMap(b))},this.remove=function(a,b){var c=null;return"undefined"!=typeof a.toQueryValue?c=a.toQueryValue():"string"==typeof a&&(c=a),c?this._action("delete",this.endpoint+"/"+c):this._action("delete",this.endpoint,this._prepare(transformQueryMap(a,b)))},this.updateOrCreate=function(a,b){var c=this;return this.update(a,b).then(function(d){if(d.length)return d[0];var e={};return Object.keys(a||{}).forEach(function(b){e[b]=a[b]}),Object.keys(b||{}).forEach(function(a){e[a]=b[a]}),c.create(e)})},this.findOrCreate=function(a,b){var c=this;return this.findOne(a).then(function(d){if(d)return d;var e={};return Object.keys(a||{}).forEach(function(b){e[b]=a[b]}),Object.keys(b||{}).forEach(function(a){e[a]=b[a]}),c.create(e)})},this._create=function(a,b){return Array.isArray(b)?this._post(a,b.map(function(a){return transformQueryMap(a)})):this._post(a,transformQueryMap(b))},this.create=function(a){return this._create(this.endpoint,a)},this._find=function(a,b,c){var d=transformQueryMap(b,c);return this._get(a,d)},this.find=function(a,b){return this._find(this.endpoint,a,b)},this.findOne=function(a,b){var c=a||{};if(c.id){var d=c.id;delete c.id;var e=this;return this._get(this.endpoint+"/"+d,transformQueryMap(c)).then(function(a){return a&&(a._endpoint=e.endpoint+"/"+d),a})}var f=b||{};return f.limit=1,this.find(c,f).then(function(a){return a&&a.length?a[0]:null})},this.getOne=function(a){var c=b.defer();return this.findOne(a).then(function(a){if(a)c.resolve(a);else{var b=new FireError("Not Found");b.number=404,c.reject(b)}}),c.promise}}}]),app.factory("TodoItemModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/todo-items",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTodoItem");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e}]),app.factory("FireModelInstanceTodoItem",["TodoItemModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTodoItem only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.list&&null!==c.list)if(Array.isArray(c.list))c.list=c.list.map(function(a){var b=d.get("FireModelInstanceTodoList");return new b(a,e+"/lists")});else{var h=d.get("FireModelInstanceTodoList");c.list=new h(c.list,e+"/lists")}Object.defineProperty(this,"list",{get:function(){return"undefined"!=typeof g._changes.list?g._changes.list:g._map.list},set:function(a){g._changes.list=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),Object.defineProperty(this,"completed",{get:function(){return"undefined"!=typeof g._changes.completed?g._changes.completed:g._map.completed},set:function(a){g._changes.completed=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTodoItem._model is deprecated.")}}),this.getList=function(b,c){var e=this;return d.get("TodoListModel")._find(a.endpoint+"/"+this.id+"/list",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TodoListModel").endpoint+"/"+a.id),e.list=a,a):null})},this.createList=function(b){var c=this;return d.get("TodoListModel")._create(a.endpoint+"/"+this.id+"/list",b).then(function(a){return c.list=a,a})},this.removeList=function(){var b=this;return d.get("TodoListModel")._action("delete",a.endpoint+"/"+this.id+"/list").then(function(a){return b.list=null,a})}}}]),app.factory("TodoListModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/todo-lists",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTodoList");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e.getCurrentList=function(){var a=(d.get("TodoItemModel"),d.get("_StorageService")),b=d.get("TodoListModel");return function(){return a.get("list")?b.findOne({id:a.get("list")}):b.create({}).then(function(b){return a.set("list",b.id),b})}()},e}]),app.factory("FireModelInstanceTodoList",["TodoListModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTodoList only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.items&&null!==c.items)if(Array.isArray(c.items))c.items=c.items.map(function(a){var b=d.get("FireModelInstanceTodoItem");return new b(a,e+"/items")});else{var h=d.get("FireModelInstanceTodoItem");c.items=new h(c.items,e+"/items")}Object.defineProperty(this,"items",{get:function(){return"undefined"!=typeof g._changes.items?g._changes.items:g._map.items},set:function(a){g._changes.items=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTodoList._model is deprecated.")}}),this.getCurrentList=function(){var a=(d.get("TodoItemModel"),d.get("_StorageService")),b=d.get("TodoListModel");return function(){return a.get("list")?b.findOne({id:a.get("list")}):b.create({}).then(function(b){return a.set("list",b.id),b})}()},this.getItems=function(b,c){var e=this;return d.get("TodoItemModel")._find(a.endpoint+"/"+this.id+"/items",b,c).then(function(a){return e.items=a,a})},this.createItem=function(b){var c=this;return d.get("TodoItemModel")._create(a.endpoint+"/"+this.id+"/items",b).then(function(a){return c.items||(c.items=[]),c.items.push(a),a})},this.removeItem=function(b){var c=_getUUID(b),e=this;return d.get("TodoItemModel")._action("delete",a.endpoint+"/"+this.id+"/items/"+c).then(function(a){for(var b=0,d=e.items.length;d>b;b++){var f=e.items[b];if(f.id===c){e.items.splice(b,1);break}}return a})},this.removeItems=function(b){var c=this;return d.get("TodoItemModel")._action("delete",a.endpoint+"/"+this.id+"/items",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return c.items=c.items.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateItems=function(b,c){var e=this;return d.get("TodoItemModel")._put(a.endpoint+"/"+this.id+"/items",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],f=0,g=e.items.length;g>f;f++){var h=e.items[f];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/tests",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTest");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e}]),app.factory("FireModelInstanceTest",["TestModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTest only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),"undefined"!=typeof c.sessions&&null!==c.sessions)if(Array.isArray(c.sessions))c.sessions=c.sessions.map(function(a){var b=d.get("FireModelInstanceTestSession");return new b(a,e+"/sessions")});else{var h=d.get("FireModelInstanceTestSession");c.sessions=new h(c.sessions,e+"/sessions")}if(Object.defineProperty(this,"sessions",{get:function(){return"undefined"!=typeof g._changes.sessions?g._changes.sessions:g._map.sessions},set:function(a){g._changes.sessions=a}}),"undefined"!=typeof c.variants&&null!==c.variants)if(Array.isArray(c.variants))c.variants=c.variants.map(function(a){var b=d.get("FireModelInstanceTestVariant");return new b(a,e+"/variants")});else{var h=d.get("FireModelInstanceTestVariant");c.variants=new h(c.variants,e+"/variants")}Object.defineProperty(this,"variants",{get:function(){return"undefined"!=typeof g._changes.variants?g._changes.variants:g._map.variants},set:function(a){g._changes.variants=a}}),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTest._model is deprecated.")}}),this.getSessions=function(b,c){var e=this;return d.get("TestSessionModel")._find(a.endpoint+"/"+this.id+"/sessions",b,c).then(function(a){return e.sessions=a,a})},this.createSession=function(b){var c=this;return d.get("TestSessionModel")._create(a.endpoint+"/"+this.id+"/sessions",b).then(function(a){return c.sessions||(c.sessions=[]),c.sessions.push(a),a})},this.removeSession=function(b){var c=_getUUID(b),e=this;return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions/"+c).then(function(a){for(var b=0,d=e.sessions.length;d>b;b++){var f=e.sessions[b];if(f.id===c){e.sessions.splice(b,1);break}}return a})},this.removeSessions=function(b){var c=this;return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return c.sessions=c.sessions.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateSessions=function(b,c){var e=this;return d.get("TestSessionModel")._put(a.endpoint+"/"+this.id+"/sessions",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],f=0,g=e.sessions.length;g>f;f++){var h=e.sessions[f];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})},this.getVariants=function(b,c){var e=this;return d.get("TestVariantModel")._find(a.endpoint+"/"+this.id+"/variants",b,c).then(function(a){return e.variants=a,a})},this.createVariant=function(b){var c=this;return d.get("TestVariantModel")._create(a.endpoint+"/"+this.id+"/variants",b).then(function(a){return c.variants||(c.variants=[]),c.variants.push(a),a})},this.removeVariant=function(b){var c=_getUUID(b),e=this;return d.get("TestVariantModel")._action("delete",a.endpoint+"/"+this.id+"/variants/"+c).then(function(a){for(var b=0,d=e.variants.length;d>b;b++){var f=e.variants[b];if(f.id===c){e.variants.splice(b,1);break}}return a})},this.removeVariants=function(b){var c=this;return d.get("TestVariantModel")._action("delete",a.endpoint+"/"+this.id+"/variants",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return c.variants=c.variants.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateVariants=function(b,c){var e=this;return d.get("TestVariantModel")._put(a.endpoint+"/"+this.id+"/variants",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],f=0,g=e.variants.length;g>f;f++){var h=e.variants[f];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestParticipantModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/test-participants",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTestParticipant");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e}]),app.factory("FireModelInstanceTestParticipant",["TestParticipantModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestParticipant only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.sessions&&null!==c.sessions)if(Array.isArray(c.sessions))c.sessions=c.sessions.map(function(a){var b=d.get("FireModelInstanceTestSession");return new b(a,e+"/sessions")});else{var h=d.get("FireModelInstanceTestSession");c.sessions=new h(c.sessions,e+"/sessions")}Object.defineProperty(this,"sessions",{get:function(){return"undefined"!=typeof g._changes.sessions?g._changes.sessions:g._map.sessions},set:function(a){g._changes.sessions=a}}),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTestParticipant._model is deprecated.")}}),this.getSessions=function(b,c){var e=this;return d.get("TestSessionModel")._find(a.endpoint+"/"+this.id+"/sessions",b,c).then(function(a){return e.sessions=a,a})},this.createSession=function(b){var c=this;return d.get("TestSessionModel")._create(a.endpoint+"/"+this.id+"/sessions",b).then(function(a){return c.sessions||(c.sessions=[]),c.sessions.push(a),a})},this.removeSession=function(b){var c=_getUUID(b),e=this;return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions/"+c).then(function(a){for(var b=0,d=e.sessions.length;d>b;b++){var f=e.sessions[b];if(f.id===c){e.sessions.splice(b,1);break}}return a})},this.removeSessions=function(b){var c=this;return d.get("TestSessionModel")._action("delete",a.endpoint+"/"+this.id+"/sessions",a._prepare(transformQueryMap(b))).then(function(a){var b=a.map(function(a){return a.id});return c.sessions=c.sessions.filter(function(a){return-1===b.indexOf(a.id)}),a})},this.updateSessions=function(b,c){var e=this;return d.get("TestSessionModel")._put(a.endpoint+"/"+this.id+"/sessions",transformQueryMap(c),transformQueryMap(b)).then(function(a){for(var b=0,c=a.length;c>b;b++)for(var d=a[b],f=0,g=e.sessions.length;g>f;f++){var h=e.sessions[f];if(h.id==d.id){Object.keys(d._map).forEach(function(a){null!==d._map[a]&&(h._map[a]=d._map[a])});break}}})}}}]),app.factory("TestSessionModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/test-sessions",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTestSession");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e}]),app.factory("FireModelInstanceTestSession",["TestSessionModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestSession only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),"undefined"!=typeof c.test&&null!==c.test)if(Array.isArray(c.test))c.test=c.test.map(function(a){var b=d.get("FireModelInstanceTest");return new b(a,e+"/tests")});else{var h=d.get("FireModelInstanceTest");c.test=new h(c.test,e+"/tests")}if(Object.defineProperty(this,"test",{get:function(){return"undefined"!=typeof g._changes.test?g._changes.test:g._map.test},set:function(a){g._changes.test=a}}),"undefined"!=typeof c.participant&&null!==c.participant)if(Array.isArray(c.participant))c.participant=c.participant.map(function(a){var b=d.get("FireModelInstanceTestParticipant");return new b(a,e+"/participants")});else{var h=d.get("FireModelInstanceTestParticipant");c.participant=new h(c.participant,e+"/participants")}Object.defineProperty(this,"participant",{get:function(){return"undefined"!=typeof g._changes.participant?g._changes.participant:g._map.participant},set:function(a){g._changes.participant=a}}),Object.defineProperty(this,"variant",{get:function(){return"undefined"!=typeof g._changes.variant?g._changes.variant:g._map.variant},set:function(a){g._changes.variant=a}}),Object.defineProperty(this,"createdAt",{get:function(){return"undefined"!=typeof g._changes.createdAt?g._changes.createdAt:g._map.createdAt},set:function(a){g._changes.createdAt=a}}),c.createdAt&&(c.createdAt=new Date(c.createdAt)),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTestSession._model is deprecated.")}}),this.getTest=function(b,c){var e=this;return d.get("TestModel")._find(a.endpoint+"/"+this.id+"/test",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestModel").endpoint+"/"+a.id),e.test=a,a):null})},this.createTest=function(b){var c=this;return d.get("TestModel")._create(a.endpoint+"/"+this.id+"/test",b).then(function(a){return c.test=a,a})},this.removeTest=function(){var b=this;return d.get("TestModel")._action("delete",a.endpoint+"/"+this.id+"/test").then(function(a){return b.test=null,a})},this.getParticipant=function(b,c){var e=this;return d.get("TestParticipantModel")._find(a.endpoint+"/"+this.id+"/participant",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestParticipantModel").endpoint+"/"+a.id),e.participant=a,a):null})},this.createParticipant=function(b){var c=this;return d.get("TestParticipantModel")._create(a.endpoint+"/"+this.id+"/participant",b).then(function(a){return c.participant=a,a})},this.removeParticipant=function(){var b=this;return d.get("TestParticipantModel")._action("delete",a.endpoint+"/"+this.id+"/participant").then(function(a){return b.participant=null,a})}}}]),app.factory("TestVariantModel",["$http","$q","FireModel","$injector",function(a,b,c,d){var e=new c;return e.endpoint="/api/test-variants",e.parseResult=function(a,b){function c(a){var c=d.get("FireModelInstanceTestVariant");return new c(a,b)}return"[object Array]"===Object.prototype.toString.call(a)?a.map(c):c(a)},e}]),app.factory("FireModelInstanceTestVariant",["TestVariantModel","$q","$http","$injector",function(a,b,c,d){return function(c,e,f){if(f)throw new Error("FireModelInstanceTestVariant only accepts two arguments now.");this._map=c||{},this._changes={},this._endpoint=this._map.id?e+"/"+this._map.id:null;var g=this;if(Object.defineProperty(this,"id",{get:function(){return"undefined"!=typeof g._changes.id?g._changes.id:g._map.id},set:function(a){g._changes.id=a}}),Object.defineProperty(this,"name",{get:function(){return"undefined"!=typeof g._changes.name?g._changes.name:g._map.name},set:function(a){g._changes.name=a}}),Object.defineProperty(this,"numberOfParticipants",{get:function(){return"undefined"!=typeof g._changes.numberOfParticipants?g._changes.numberOfParticipants:g._map.numberOfParticipants},set:function(a){g._changes.numberOfParticipants=a}}),"undefined"!=typeof c.test&&null!==c.test)if(Array.isArray(c.test))c.test=c.test.map(function(a){var b=d.get("FireModelInstanceTest");return new b(a,e+"/tests")});else{var h=d.get("FireModelInstanceTest");c.test=new h(c.test,e+"/tests")}Object.defineProperty(this,"test",{get:function(){return"undefined"!=typeof g._changes.test?g._changes.test:g._map.test},set:function(a){g._changes.test=a}}),this.cancel=function(){this._changes={}},this.refresh=function(a){return this._map=a._map,this},this.toQueryValue=function(){return this._map.id},this.remove=function(){return a.remove(this._map.id)},this.save=function(){var c=this;return b.when(Object.keys(this._changes).length).then(function(b){if(b){var d=transformQueryMap(c._changes);return a._put(c._endpoint,d).then(function(a){return c._changes={},Object.keys(a._map).forEach(function(b){null!==a._map[b]&&(c._map[b]=a._map[b])}),c})}return c})},Object.defineProperty(this,"_model",{get:function(){throw new Error("FireModelInstanceTestVariant._model is deprecated.")}}),this.getTest=function(b,c){var e=this;return d.get("TestModel")._find(a.endpoint+"/"+this.id+"/test",b,c).then(function(a){return a?(a&&(a._endpoint=d.get("TestModel").endpoint+"/"+a.id),e.test=a,a):null})},this.createTest=function(b){var c=this;return d.get("TestModel")._create(a.endpoint+"/"+this.id+"/test",b).then(function(a){return c.test=a,a})},this.removeTest=function(){var b=this;return d.get("TestModel")._action("delete",a.endpoint+"/"+this.id+"/test").then(function(a){return b.test=null,a})}}}]),app.service("FireModels",[function(){throw new Error("FireModels service is deprecated.")}]),app.service("fire",["FireModels","$http","$q",function(a,b,c){function d(a,b){var c=b;return a.then(function(a){angular.copy(a,c)}),c}this.unwrap=d,this.models=a,this.isServer=function(){return!1},this.isClient=function(){return!0}}]),app.config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode({enabled:!0,requireBase:!1}),a.when("/",{templateUrl:"/templates/todo.html",controller:"TodoController",resolve:{list:["TodoListModel",function(a){return a.getCurrentList(123)}]}}),a.when("/:status",{templateUrl:"/templates/todo.html",controller:"TodoController",resolve:{list:["TodoListModel",function(a){return a.getCurrentList(123)}]}})}]),app.service("ChannelService",["WebSocketService","$rootScope",function(a,b){function c(a,b){return b+":"+a}var d={};this.registerChannel=function(a){d[c(a.id,a.type)]=a,this.sendMessageOnChannel({event:"_subscribe"},a)},this.getChannel=function(a,b){return d[c(a,b)]},this.getUnknownMessage=function(a,b){console.log("Unknown message.")},this.sendMessageOnChannel=function(b,c){return a.send({channel:{type:c.type,id:c.id},message:b})};var e=this;a.parsePacket=function(a){var c=e.getChannel(a.channel.id,a.channel.type);c?c.delegate?b.$apply(function(){c.delegate(a.message)}):console.log("Warning: no delegate set on channel."):b.$apply(function(){e.getUnknownMessage(a.message,a.channel)})}}]),app.service("WebSocketService",["$location","$timeout",function(a,b){function c(){g++,i=new WebSocket("ws://"+a.host()+(a.port()?":"+a.port():"")),i.onopen=k,i.onerror=l,i.onclose=m,i.onmessage=n}var d=[],e=1e3,f=1.5,g=0,h=6e4,i=null,j=this,k=function(){if(d&&d.length>0){var a=d;d=null,a.forEach(function(a){j.send(a)})}},l=function(a){console.log("error"),console.log(a)},m=function(a){b(c,Math.max(h,e*Math.pow(f,g)))},n=function(a){var b=JSON.parse(a.data);j.parsePacket&&j.parsePacket(b)};this.send=function(a){null!==d?d.push(a):(console.log(i),i.send(JSON.stringify(a)))},this.parsePacket=null,c()}]),app.service("_StorageService",[function(){var a={};this.get=function(b){return"undefined"!=typeof a[b]?a[b]:window.localStorage.getItem(b)},this.set=function(b,c){try{window.localStorage.setItem(b,c)}catch(d){a[b]=c}},this.unset=function(b){"undefined"!=typeof a[b]?delete a[b]:window.localStorage.removeItem(b)}}]),app.provider("TestsService",[function(){var a=null;this.delegate=function(b){a=b},this.$get=function(){return{participate:function(b,c){if(null===a)throw new Error("Please set the TestsService.delegate");if("function"!=typeof a)throw new Error("TestsService#delegate must be a function.");a(b,c)}}}}]);
//# sourceMappingURL=fire.min.js.map