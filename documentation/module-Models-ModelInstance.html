<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Documentation Class: ModelInstance - Node on Fire</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
	<link rel="stylesheet" href="/styles/default.css"/>
</head>

<body>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="col-md-8 col-md-offset-2">
				<ul class="nav navbar-nav">
					<li><a href="/">Home</a></li>
					<li><a href="/getting-started">Getting Started</a></li>
					<li class="active"><a href="/documentation">Documentation</a></li>
					<li><a href="/examples">Examples</a></li>
					<li><a href="/tutorials">Tutorials</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<div class="col-md-offset-1 col-md-3">
				
				<div id="toc"></div>
				
			</div>

			<div id="main" class="col-md-7">
				


	<h1 class="page-title">Class: ModelInstance</h1>
<section>

<header>
    <h2>
        <span class="ancestors"><a href="module-Models.html">Models</a>~</span>
    
    ModelInstance
    </h2>
    
</header>

<article>
    <div class="container-overview">
    

    
        
<dt>
    <h4 class="name" id="ModelInstance"><span class="type-signature"></span>new ModelInstance<span class="signature">(model, row, changes, id)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>A model instance represents one or multiple rows in the database. These instances are usually the return value(s) of Model#find, Model#create and Model#update methods.</p>
<p>This calls the beforeLoad hook when initialization starts and calls afterLoad when initializations finishes. To declare a hook, declare a method with the hook name on the model's prototype. For example, this creates an afterCreate hook on a User model:</p>
<pre class="prettyprint source lang-js"><code>function User() {
    this.email = [this.String, this.Authenticate];
    this.type = [this.String];
    this.posts = [this.HasMany(this.models.Post)];
}
app.model(User);

User.prototype.afterCreate = function() {
    // Gets executed whenever a new model instance is created.
};</code></pre>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>model</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Model</span>



            
            </td>

            

            

            <td class="description last"><p>The model the instance belongs to.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>row</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Dictionary</span>



            
            </td>

            

            

            <td class="description last"><p>A map of all column-value pairs from the database.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>changes</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Dictionary</span>



            
            </td>

            

            

            <td class="description last"><p>A map of property-value pairs set by the caller.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>id</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">String</span>



            
            </td>

            

            

            <td class="description last"><p>The instance primary key's value, if known.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        <dl>
            
<dt>
    <h4 class="name" id="addAssociation"><span class="type-signature"></span>addAssociation<span class="signature">(property, modelInstance)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Adds modelInstance as association of property.</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>property</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Property</span>



            
            </td>

            

            

            <td class="description last"><p>The property of the association the model instance is added to.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>modelInstance</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">ModelInstance</span>



            
            </td>

            

            

            <td class="description last"><p>The model instance to be added to the association.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="callHooks"><span class="type-signature"></span>callHooks<span class="signature">(hookNames)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Warning: in the future the effects of these hooks might change. Currently the hooks are invoked on the same process, in the future, the hooks will be invoked in a worker process.</p>
<p>Internally calls the hooks.</p>
<p>The following hooks are supported:</p>
<h5>afterLoad</h5><p>After a model instance is loaded this hook is called.</p>
<h5>afterSave</h5><p>invoked after the model instance successfully saved (either a new instance or updated instance).</p>
<h5>afterCreate</h5><p>invoked after a new instance is created.</p>
<h5>afterUpdate</h5><p>Invoked after a model instance is updated, either after ModelInstance#save or Model#update.</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>hookNames</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Array</span>



            
            </td>

            

            

            <td class="description last"><p>List of hook names to invoke the methods of.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="checkProperties"><span class="type-signature"></span>checkProperties<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Internally checks all the values of the properties, applies any transform methods, if neccesary, and sets any default values, if specified.</p>
    </div>
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="configureProperty"><span class="type-signature"></span>configureProperty<span class="signature">(property)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Adds property <code>property</code> to the model instance. This configures accessor methods of the property and any relationships. This is invoked when constructing the model instance right after <code>beforeLoad</code> hook and before <code>afterLoad</code> hook.</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>property</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Property</span>



            
            </td>

            

            

            <td class="description last"><p>The property to configure.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="consumeRow"><span class="type-signature"></span>consumeRow<span class="signature">(row)</span></h4>
    
    
</dt>
<dd>
    
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>row</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Dictionary</span>



            
            </td>

            

            

            <td class="description last"><p>A row from the datastore.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
	<dt class="tag-todo">To Do:</dt>
	<dd class="tag-todo">
		<ul>
			<li>This method and ModelInstance#parseRow have similar code. They should be merged. It's not DRY.

Reads the information of a datastore's row and parses the row if it's considerd part of this model instance.</li>
			</ul>
	</dd>
	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    <p>Returns true if the row is consumed by this model instance, false if not.</p>
</div>



<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">Boolean</span>



	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="createAssociations"><span class="type-signature"></span>createAssociations<span class="signature">(associations)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Parses the associations dictionary and creates model instances for every association.</p>
<p>Each value in the dictionary is a dictionary of column name-value pairs. An association only has one dictionary, because the associations are added per row. This method generally gets called multiple times per model instance (depending on the number of associations).</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>associations</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Dictionary</span>



            
            </td>

            

            

            <td class="description last"><p>The dictionary with the association names as keys.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    <p>Returns true if a valid association is added, false otherwise.</p>
</div>



<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">Boolean</span>



	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="parseRow"><span class="type-signature"></span>parseRow<span class="signature">(row)</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Parses the given row and any associations it finds.</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>row</code></td>
            

            <td class="type">
            
                
<span class="label label-primary param-type">Dictionary</span>



            
            </td>

            

            

            <td class="description last"><p>Map of column name-value pairs.</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="resolvePromises"><span class="type-signature"></span>resolvePromises<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Resolves all promises set on the model instance.</p>
<p>This makes it possible to set unresolved promises as values of properties. This method is called during saving. If any of the promises rejects, the saving of the model rejects, too.</p>
<p>For example, consider creating a project instance with an owner property:</p>
<pre class="prettyprint source lang-js"><code>this.models.Project.create({
    name: 'Test Project',
    owner: this.models.User.findOne({name: 'Martijn'})
});</code></pre>
    </div>
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="save"><span class="type-signature"></span>save<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Saves the model instance. This either creates a new model instance, or updates an existing model instance.</p>
<pre class="prettyprint source"><code>this.models.Post.create({
        title: 'The Adventures of Huckleberry Finn',
      createdAt: new Date()
 })
 .then(function(post) {
     post.title = 'Confessions of a Shopaholic'
     return post.save();
    })</code></pre>
    </div>
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            


<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">Promise</span>



	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="toJSON"><span class="type-signature"></span>toJSON<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Convert the instance to a simple Dictionary when JSON#stringify is called.</p>
<p>All auto-fetched assocations are included in the returned dictionary, see PropertyTypes#AutoFetch on how to configure associations to be auto-fetched.</p>
<p>A _type key is also included. The _type's value is the name of the model. This is used in the client-side parser to allocate and initialize the correct model instance.</p>
<p>Private properties, like a password, are not included in the returned dictionary, see PropertyTypes#Private on how to declare private properties.</p>
    </div>
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    <p>The JSON representation of the model instance.</p>
</div>



<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">Dictionary</span>



	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="toQueryValue"><span class="type-signature"></span>toQueryValue<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>toQueryValue is executed by Table to convert a model instance to a valid parameter in a query.</p>
    </div>
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            


<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">String</span>



	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="validateChanges"><span class="type-signature"></span>validateChanges<span class="signature">()</span></h4>
    
    
</dt>
<dd>
    
    

    
    
    
    
    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
	<dt class="tag-todo">To Do:</dt>
	<dd class="tag-todo">
		<ul>
			<li>Replace this by PropertyTypes#Validate.

Validates all set property values. This calls a validate method named after the property's name prefixed with validate. If the method returns a truthy value the property value is considered valid. If anything else the value is considered invalid.

This method is invoked before saving the model in ModelInstance#save.</li>
			</ul>
	</dd>
	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            


<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="label label-primary param-type">Promise</span>



	</dd>
</dl>


        
    
    
</dd>

        </dl>
    

    

    
</article>

</section>




			</div>
		</div>

		<div class="row">
			<div class="col-md-offset-4 col-md-7">
				<p class="expl disqus-expl">Do you have any questions or comments on this page? Start a discussion below.</p>

			    <div id="disqus_thread"></div>
				<script type="text/javascript">
    			var disqus_shortname = 'nodeonfire';
    			(function() {
        			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    			})();
				</script>
				<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>
		</div>

		<div class="row">
			<div class="col-md-offset-4 col-md-7">
				This is the footer.
			</div>
		</div>
	</div>

	<script src="/bower_components/jquery/dist/jquery.min.js"></script>
	<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="scripts/toc.js"></script>
	<script>
		$( function () {
			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "0px"
			} );

			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );
		} );
	 </script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-52717773-3', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>